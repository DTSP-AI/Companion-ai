"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunk_N_E"] = self["webpackChunk_N_E"] || []).push([["_app-pages-browser_node_modules_langchain_dist_chains_combine_docs_chain_js"],{

/***/ "(app-pages-browser)/./node_modules/langchain/dist/chains/combine_docs_chain.js":
/*!******************************************************************!*\
  !*** ./node_modules/langchain/dist/chains/combine_docs_chain.js ***!
  \******************************************************************/
/***/ (function(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   MapReduceDocumentsChain: function() { return /* binding */ MapReduceDocumentsChain; },\n/* harmony export */   RefineDocumentsChain: function() { return /* binding */ RefineDocumentsChain; },\n/* harmony export */   StuffDocumentsChain: function() { return /* binding */ StuffDocumentsChain; }\n/* harmony export */ });\n/* harmony import */ var _langchain_core_prompts__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @langchain/core/prompts */ \"(app-pages-browser)/./node_modules/@langchain/core/prompts.js\");\n/* harmony import */ var _base_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./base.js */ \"(app-pages-browser)/./node_modules/langchain/dist/chains/base.js\");\n/* harmony import */ var _llm_chain_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./llm_chain.js */ \"(app-pages-browser)/./node_modules/langchain/dist/chains/llm_chain.js\");\n\n\n\n/**\n * Chain that combines documents by stuffing into context.\n * @augments BaseChain\n * @augments StuffDocumentsChainInput\n */\nclass StuffDocumentsChain extends _base_js__WEBPACK_IMPORTED_MODULE_1__.BaseChain {\n    static lc_name() {\n        return \"StuffDocumentsChain\";\n    }\n    get inputKeys() {\n        return [this.inputKey, ...this.llmChain.inputKeys].filter((key) => key !== this.documentVariableName);\n    }\n    get outputKeys() {\n        return this.llmChain.outputKeys;\n    }\n    constructor(fields) {\n        super(fields);\n        Object.defineProperty(this, \"llmChain\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"inputKey\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"input_documents\"\n        });\n        Object.defineProperty(this, \"documentVariableName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"context\"\n        });\n        this.llmChain = fields.llmChain;\n        this.documentVariableName =\n            fields.documentVariableName ?? this.documentVariableName;\n        this.inputKey = fields.inputKey ?? this.inputKey;\n    }\n    /** @ignore */\n    _prepInputs(values) {\n        if (!(this.inputKey in values)) {\n            throw new Error(`Document key ${this.inputKey} not found.`);\n        }\n        const { [this.inputKey]: docs, ...rest } = values;\n        const texts = docs.map(({ pageContent }) => pageContent);\n        const text = texts.join(\"\\n\\n\");\n        return {\n            ...rest,\n            [this.documentVariableName]: text,\n        };\n    }\n    /** @ignore */\n    async _call(values, runManager) {\n        const result = await this.llmChain.call(this._prepInputs(values), runManager?.getChild(\"combine_documents\"));\n        return result;\n    }\n    _chainType() {\n        return \"stuff_documents_chain\";\n    }\n    static async deserialize(data) {\n        if (!data.llm_chain) {\n            throw new Error(\"Missing llm_chain\");\n        }\n        return new StuffDocumentsChain({\n            llmChain: await _llm_chain_js__WEBPACK_IMPORTED_MODULE_2__.LLMChain.deserialize(data.llm_chain),\n        });\n    }\n    serialize() {\n        return {\n            _type: this._chainType(),\n            llm_chain: this.llmChain.serialize(),\n        };\n    }\n}\n/**\n * Combine documents by mapping a chain over them, then combining results.\n * @augments BaseChain\n * @augments StuffDocumentsChainInput\n */\nclass MapReduceDocumentsChain extends _base_js__WEBPACK_IMPORTED_MODULE_1__.BaseChain {\n    static lc_name() {\n        return \"MapReduceDocumentsChain\";\n    }\n    get inputKeys() {\n        return [this.inputKey, ...this.combineDocumentChain.inputKeys];\n    }\n    get outputKeys() {\n        return this.combineDocumentChain.outputKeys;\n    }\n    constructor(fields) {\n        super(fields);\n        Object.defineProperty(this, \"llmChain\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"inputKey\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"input_documents\"\n        });\n        Object.defineProperty(this, \"documentVariableName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"context\"\n        });\n        Object.defineProperty(this, \"returnIntermediateSteps\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: false\n        });\n        Object.defineProperty(this, \"maxTokens\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 3000\n        });\n        Object.defineProperty(this, \"maxIterations\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 10\n        });\n        Object.defineProperty(this, \"ensureMapStep\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: false\n        });\n        Object.defineProperty(this, \"combineDocumentChain\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.llmChain = fields.llmChain;\n        this.combineDocumentChain = fields.combineDocumentChain;\n        this.documentVariableName =\n            fields.documentVariableName ?? this.documentVariableName;\n        this.ensureMapStep = fields.ensureMapStep ?? this.ensureMapStep;\n        this.inputKey = fields.inputKey ?? this.inputKey;\n        this.maxTokens = fields.maxTokens ?? this.maxTokens;\n        this.maxIterations = fields.maxIterations ?? this.maxIterations;\n        this.returnIntermediateSteps = fields.returnIntermediateSteps ?? false;\n    }\n    /** @ignore */\n    async _call(values, runManager) {\n        if (!(this.inputKey in values)) {\n            throw new Error(`Document key ${this.inputKey} not found.`);\n        }\n        const { [this.inputKey]: docs, ...rest } = values;\n        let currentDocs = docs;\n        let intermediateSteps = [];\n        // For each iteration, we'll use the `llmChain` to get a new result\n        for (let i = 0; i < this.maxIterations; i += 1) {\n            const inputs = currentDocs.map((d) => ({\n                [this.documentVariableName]: d.pageContent,\n                ...rest,\n            }));\n            const canSkipMapStep = i !== 0 || !this.ensureMapStep;\n            if (canSkipMapStep) {\n                // Calculate the total tokens required in the input\n                const formatted = await this.combineDocumentChain.llmChain.prompt.format(this.combineDocumentChain._prepInputs({\n                    [this.combineDocumentChain.inputKey]: currentDocs,\n                    ...rest,\n                }));\n                const length = await this.combineDocumentChain.llmChain._getNumTokens(formatted);\n                const withinTokenLimit = length < this.maxTokens;\n                // If we can skip the map step, and we're within the token limit, we don't\n                // need to run the map step, so just break out of the loop.\n                if (withinTokenLimit) {\n                    break;\n                }\n            }\n            const results = await this.llmChain.apply(inputs, \n            // If we have a runManager, then we need to create a child for each input\n            // so that we can track the progress of each input.\n            runManager\n                ? Array.from({ length: inputs.length }, (_, i) => runManager.getChild(`map_${i + 1}`))\n                : undefined);\n            const { outputKey } = this.llmChain;\n            // If the flag is set, then concat that to the intermediate steps\n            if (this.returnIntermediateSteps) {\n                intermediateSteps = intermediateSteps.concat(results.map((r) => r[outputKey]));\n            }\n            currentDocs = results.map((r) => ({\n                pageContent: r[outputKey],\n                metadata: {},\n            }));\n        }\n        // Now, with the final result of all the inputs from the `llmChain`, we can\n        // run the `combineDocumentChain` over them.\n        const newInputs = {\n            [this.combineDocumentChain.inputKey]: currentDocs,\n            ...rest,\n        };\n        const result = await this.combineDocumentChain.call(newInputs, runManager?.getChild(\"combine_documents\"));\n        // Return the intermediate steps results if the flag is set\n        if (this.returnIntermediateSteps) {\n            return { ...result, intermediateSteps };\n        }\n        return result;\n    }\n    _chainType() {\n        return \"map_reduce_documents_chain\";\n    }\n    static async deserialize(data) {\n        if (!data.llm_chain) {\n            throw new Error(\"Missing llm_chain\");\n        }\n        if (!data.combine_document_chain) {\n            throw new Error(\"Missing combine_document_chain\");\n        }\n        return new MapReduceDocumentsChain({\n            llmChain: await _llm_chain_js__WEBPACK_IMPORTED_MODULE_2__.LLMChain.deserialize(data.llm_chain),\n            combineDocumentChain: await StuffDocumentsChain.deserialize(data.combine_document_chain),\n        });\n    }\n    serialize() {\n        return {\n            _type: this._chainType(),\n            llm_chain: this.llmChain.serialize(),\n            combine_document_chain: this.combineDocumentChain.serialize(),\n        };\n    }\n}\n/**\n * Combine documents by doing a first pass and then refining on more documents.\n * @augments BaseChain\n * @augments RefineDocumentsChainInput\n */\nclass RefineDocumentsChain extends _base_js__WEBPACK_IMPORTED_MODULE_1__.BaseChain {\n    static lc_name() {\n        return \"RefineDocumentsChain\";\n    }\n    get defaultDocumentPrompt() {\n        return new _langchain_core_prompts__WEBPACK_IMPORTED_MODULE_0__.PromptTemplate({\n            inputVariables: [\"page_content\"],\n            template: \"{page_content}\",\n        });\n    }\n    get inputKeys() {\n        return [\n            ...new Set([\n                this.inputKey,\n                ...this.llmChain.inputKeys,\n                ...this.refineLLMChain.inputKeys,\n            ]),\n        ].filter((key) => key !== this.documentVariableName && key !== this.initialResponseName);\n    }\n    get outputKeys() {\n        return [this.outputKey];\n    }\n    constructor(fields) {\n        super(fields);\n        Object.defineProperty(this, \"llmChain\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"inputKey\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"input_documents\"\n        });\n        Object.defineProperty(this, \"outputKey\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"output_text\"\n        });\n        Object.defineProperty(this, \"documentVariableName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"context\"\n        });\n        Object.defineProperty(this, \"initialResponseName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"existing_answer\"\n        });\n        Object.defineProperty(this, \"refineLLMChain\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"documentPrompt\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: this.defaultDocumentPrompt\n        });\n        this.llmChain = fields.llmChain;\n        this.refineLLMChain = fields.refineLLMChain;\n        this.documentVariableName =\n            fields.documentVariableName ?? this.documentVariableName;\n        this.inputKey = fields.inputKey ?? this.inputKey;\n        this.outputKey = fields.outputKey ?? this.outputKey;\n        this.documentPrompt = fields.documentPrompt ?? this.documentPrompt;\n        this.initialResponseName =\n            fields.initialResponseName ?? this.initialResponseName;\n    }\n    /** @ignore */\n    async _constructInitialInputs(doc, rest) {\n        const baseInfo = {\n            page_content: doc.pageContent,\n            ...doc.metadata,\n        };\n        const documentInfo = {};\n        this.documentPrompt.inputVariables.forEach((value) => {\n            documentInfo[value] = baseInfo[value];\n        });\n        const baseInputs = {\n            [this.documentVariableName]: await this.documentPrompt.format({\n                ...documentInfo,\n            }),\n        };\n        const inputs = { ...baseInputs, ...rest };\n        return inputs;\n    }\n    /** @ignore */\n    async _constructRefineInputs(doc, res) {\n        const baseInfo = {\n            page_content: doc.pageContent,\n            ...doc.metadata,\n        };\n        const documentInfo = {};\n        this.documentPrompt.inputVariables.forEach((value) => {\n            documentInfo[value] = baseInfo[value];\n        });\n        const baseInputs = {\n            [this.documentVariableName]: await this.documentPrompt.format({\n                ...documentInfo,\n            }),\n        };\n        const inputs = { [this.initialResponseName]: res, ...baseInputs };\n        return inputs;\n    }\n    /** @ignore */\n    async _call(values, runManager) {\n        if (!(this.inputKey in values)) {\n            throw new Error(`Document key ${this.inputKey} not found.`);\n        }\n        const { [this.inputKey]: docs, ...rest } = values;\n        const currentDocs = docs;\n        const initialInputs = await this._constructInitialInputs(currentDocs[0], rest);\n        let res = await this.llmChain.predict({ ...initialInputs }, runManager?.getChild(\"answer\"));\n        const refineSteps = [res];\n        for (let i = 1; i < currentDocs.length; i += 1) {\n            const refineInputs = await this._constructRefineInputs(currentDocs[i], res);\n            const inputs = { ...refineInputs, ...rest };\n            res = await this.refineLLMChain.predict({ ...inputs }, runManager?.getChild(\"refine\"));\n            refineSteps.push(res);\n        }\n        return { [this.outputKey]: res };\n    }\n    _chainType() {\n        return \"refine_documents_chain\";\n    }\n    static async deserialize(data) {\n        const SerializedLLMChain = data.llm_chain;\n        if (!SerializedLLMChain) {\n            throw new Error(\"Missing llm_chain\");\n        }\n        const SerializedRefineDocumentChain = data.refine_llm_chain;\n        if (!SerializedRefineDocumentChain) {\n            throw new Error(\"Missing refine_llm_chain\");\n        }\n        return new RefineDocumentsChain({\n            llmChain: await _llm_chain_js__WEBPACK_IMPORTED_MODULE_2__.LLMChain.deserialize(SerializedLLMChain),\n            refineLLMChain: await _llm_chain_js__WEBPACK_IMPORTED_MODULE_2__.LLMChain.deserialize(SerializedRefineDocumentChain),\n        });\n    }\n    serialize() {\n        return {\n            _type: this._chainType(),\n            llm_chain: this.llmChain.serialize(),\n            refine_llm_chain: this.refineLLMChain.serialize(),\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwcC1wYWdlcy1icm93c2VyKS8uL25vZGVfbW9kdWxlcy9sYW5nY2hhaW4vZGlzdC9jaGFpbnMvY29tYmluZV9kb2NzX2NoYWluLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUF5RDtBQUNuQjtBQUNJO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTyxrQ0FBa0MsK0NBQVM7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEMsZUFBZTtBQUMzRDtBQUNBLGdCQUFnQixpQ0FBaUM7QUFDakQsa0NBQWtDLGFBQWE7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsbURBQVE7QUFDcEMsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ08sc0NBQXNDLCtDQUFTO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEMsZUFBZTtBQUMzRDtBQUNBLGdCQUFnQixpQ0FBaUM7QUFDakQ7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHdCQUF3QjtBQUNoRDtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQix1QkFBdUIsdUNBQXVDLE1BQU07QUFDbkc7QUFDQSxvQkFBb0IsWUFBWTtBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEI7QUFDNUIsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsbURBQVE7QUFDcEM7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPLG1DQUFtQywrQ0FBUztBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQixtRUFBYztBQUNqQztBQUNBLHdCQUF3QixhQUFhO0FBQ3JDLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNENBQTRDLGVBQWU7QUFDM0Q7QUFDQSxnQkFBZ0IsaUNBQWlDO0FBQ2pEO0FBQ0E7QUFDQSxnREFBZ0Qsa0JBQWtCO0FBQ2xFO0FBQ0Esd0JBQXdCLHdCQUF3QjtBQUNoRDtBQUNBLDZCQUE2QjtBQUM3QixzREFBc0QsV0FBVztBQUNqRTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsbURBQVE7QUFDcEMsa0NBQWtDLG1EQUFRO0FBQzFDLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9fTl9FLy4vbm9kZV9tb2R1bGVzL2xhbmdjaGFpbi9kaXN0L2NoYWlucy9jb21iaW5lX2RvY3NfY2hhaW4uanM/NjNiYiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcm9tcHRUZW1wbGF0ZSB9IGZyb20gXCJAbGFuZ2NoYWluL2NvcmUvcHJvbXB0c1wiO1xuaW1wb3J0IHsgQmFzZUNoYWluIH0gZnJvbSBcIi4vYmFzZS5qc1wiO1xuaW1wb3J0IHsgTExNQ2hhaW4gfSBmcm9tIFwiLi9sbG1fY2hhaW4uanNcIjtcbi8qKlxuICogQ2hhaW4gdGhhdCBjb21iaW5lcyBkb2N1bWVudHMgYnkgc3R1ZmZpbmcgaW50byBjb250ZXh0LlxuICogQGF1Z21lbnRzIEJhc2VDaGFpblxuICogQGF1Z21lbnRzIFN0dWZmRG9jdW1lbnRzQ2hhaW5JbnB1dFxuICovXG5leHBvcnQgY2xhc3MgU3R1ZmZEb2N1bWVudHNDaGFpbiBleHRlbmRzIEJhc2VDaGFpbiB7XG4gICAgc3RhdGljIGxjX25hbWUoKSB7XG4gICAgICAgIHJldHVybiBcIlN0dWZmRG9jdW1lbnRzQ2hhaW5cIjtcbiAgICB9XG4gICAgZ2V0IGlucHV0S2V5cygpIHtcbiAgICAgICAgcmV0dXJuIFt0aGlzLmlucHV0S2V5LCAuLi50aGlzLmxsbUNoYWluLmlucHV0S2V5c10uZmlsdGVyKChrZXkpID0+IGtleSAhPT0gdGhpcy5kb2N1bWVudFZhcmlhYmxlTmFtZSk7XG4gICAgfVxuICAgIGdldCBvdXRwdXRLZXlzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sbG1DaGFpbi5vdXRwdXRLZXlzO1xuICAgIH1cbiAgICBjb25zdHJ1Y3RvcihmaWVsZHMpIHtcbiAgICAgICAgc3VwZXIoZmllbGRzKTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwibGxtQ2hhaW5cIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IHZvaWQgMFxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiaW5wdXRLZXlcIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IFwiaW5wdXRfZG9jdW1lbnRzXCJcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImRvY3VtZW50VmFyaWFibGVOYW1lXCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiBcImNvbnRleHRcIlxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5sbG1DaGFpbiA9IGZpZWxkcy5sbG1DaGFpbjtcbiAgICAgICAgdGhpcy5kb2N1bWVudFZhcmlhYmxlTmFtZSA9XG4gICAgICAgICAgICBmaWVsZHMuZG9jdW1lbnRWYXJpYWJsZU5hbWUgPz8gdGhpcy5kb2N1bWVudFZhcmlhYmxlTmFtZTtcbiAgICAgICAgdGhpcy5pbnB1dEtleSA9IGZpZWxkcy5pbnB1dEtleSA/PyB0aGlzLmlucHV0S2V5O1xuICAgIH1cbiAgICAvKiogQGlnbm9yZSAqL1xuICAgIF9wcmVwSW5wdXRzKHZhbHVlcykge1xuICAgICAgICBpZiAoISh0aGlzLmlucHV0S2V5IGluIHZhbHVlcykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRG9jdW1lbnQga2V5ICR7dGhpcy5pbnB1dEtleX0gbm90IGZvdW5kLmApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgW3RoaXMuaW5wdXRLZXldOiBkb2NzLCAuLi5yZXN0IH0gPSB2YWx1ZXM7XG4gICAgICAgIGNvbnN0IHRleHRzID0gZG9jcy5tYXAoKHsgcGFnZUNvbnRlbnQgfSkgPT4gcGFnZUNvbnRlbnQpO1xuICAgICAgICBjb25zdCB0ZXh0ID0gdGV4dHMuam9pbihcIlxcblxcblwiKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICBbdGhpcy5kb2N1bWVudFZhcmlhYmxlTmFtZV06IHRleHQsXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKiBAaWdub3JlICovXG4gICAgYXN5bmMgX2NhbGwodmFsdWVzLCBydW5NYW5hZ2VyKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMubGxtQ2hhaW4uY2FsbCh0aGlzLl9wcmVwSW5wdXRzKHZhbHVlcyksIHJ1bk1hbmFnZXI/LmdldENoaWxkKFwiY29tYmluZV9kb2N1bWVudHNcIikpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBfY2hhaW5UeXBlKCkge1xuICAgICAgICByZXR1cm4gXCJzdHVmZl9kb2N1bWVudHNfY2hhaW5cIjtcbiAgICB9XG4gICAgc3RhdGljIGFzeW5jIGRlc2VyaWFsaXplKGRhdGEpIHtcbiAgICAgICAgaWYgKCFkYXRhLmxsbV9jaGFpbikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWlzc2luZyBsbG1fY2hhaW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBTdHVmZkRvY3VtZW50c0NoYWluKHtcbiAgICAgICAgICAgIGxsbUNoYWluOiBhd2FpdCBMTE1DaGFpbi5kZXNlcmlhbGl6ZShkYXRhLmxsbV9jaGFpbiksXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzZXJpYWxpemUoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBfdHlwZTogdGhpcy5fY2hhaW5UeXBlKCksXG4gICAgICAgICAgICBsbG1fY2hhaW46IHRoaXMubGxtQ2hhaW4uc2VyaWFsaXplKCksXG4gICAgICAgIH07XG4gICAgfVxufVxuLyoqXG4gKiBDb21iaW5lIGRvY3VtZW50cyBieSBtYXBwaW5nIGEgY2hhaW4gb3ZlciB0aGVtLCB0aGVuIGNvbWJpbmluZyByZXN1bHRzLlxuICogQGF1Z21lbnRzIEJhc2VDaGFpblxuICogQGF1Z21lbnRzIFN0dWZmRG9jdW1lbnRzQ2hhaW5JbnB1dFxuICovXG5leHBvcnQgY2xhc3MgTWFwUmVkdWNlRG9jdW1lbnRzQ2hhaW4gZXh0ZW5kcyBCYXNlQ2hhaW4ge1xuICAgIHN0YXRpYyBsY19uYW1lKCkge1xuICAgICAgICByZXR1cm4gXCJNYXBSZWR1Y2VEb2N1bWVudHNDaGFpblwiO1xuICAgIH1cbiAgICBnZXQgaW5wdXRLZXlzKCkge1xuICAgICAgICByZXR1cm4gW3RoaXMuaW5wdXRLZXksIC4uLnRoaXMuY29tYmluZURvY3VtZW50Q2hhaW4uaW5wdXRLZXlzXTtcbiAgICB9XG4gICAgZ2V0IG91dHB1dEtleXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbWJpbmVEb2N1bWVudENoYWluLm91dHB1dEtleXM7XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yKGZpZWxkcykge1xuICAgICAgICBzdXBlcihmaWVsZHMpO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJsbG1DaGFpblwiLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogdm9pZCAwXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJpbnB1dEtleVwiLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogXCJpbnB1dF9kb2N1bWVudHNcIlxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiZG9jdW1lbnRWYXJpYWJsZU5hbWVcIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IFwiY29udGV4dFwiXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJyZXR1cm5JbnRlcm1lZGlhdGVTdGVwc1wiLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm1heFRva2Vuc1wiLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogMzAwMFxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwibWF4SXRlcmF0aW9uc1wiLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogMTBcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImVuc3VyZU1hcFN0ZXBcIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJjb21iaW5lRG9jdW1lbnRDaGFpblwiLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogdm9pZCAwXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmxsbUNoYWluID0gZmllbGRzLmxsbUNoYWluO1xuICAgICAgICB0aGlzLmNvbWJpbmVEb2N1bWVudENoYWluID0gZmllbGRzLmNvbWJpbmVEb2N1bWVudENoYWluO1xuICAgICAgICB0aGlzLmRvY3VtZW50VmFyaWFibGVOYW1lID1cbiAgICAgICAgICAgIGZpZWxkcy5kb2N1bWVudFZhcmlhYmxlTmFtZSA/PyB0aGlzLmRvY3VtZW50VmFyaWFibGVOYW1lO1xuICAgICAgICB0aGlzLmVuc3VyZU1hcFN0ZXAgPSBmaWVsZHMuZW5zdXJlTWFwU3RlcCA/PyB0aGlzLmVuc3VyZU1hcFN0ZXA7XG4gICAgICAgIHRoaXMuaW5wdXRLZXkgPSBmaWVsZHMuaW5wdXRLZXkgPz8gdGhpcy5pbnB1dEtleTtcbiAgICAgICAgdGhpcy5tYXhUb2tlbnMgPSBmaWVsZHMubWF4VG9rZW5zID8/IHRoaXMubWF4VG9rZW5zO1xuICAgICAgICB0aGlzLm1heEl0ZXJhdGlvbnMgPSBmaWVsZHMubWF4SXRlcmF0aW9ucyA/PyB0aGlzLm1heEl0ZXJhdGlvbnM7XG4gICAgICAgIHRoaXMucmV0dXJuSW50ZXJtZWRpYXRlU3RlcHMgPSBmaWVsZHMucmV0dXJuSW50ZXJtZWRpYXRlU3RlcHMgPz8gZmFsc2U7XG4gICAgfVxuICAgIC8qKiBAaWdub3JlICovXG4gICAgYXN5bmMgX2NhbGwodmFsdWVzLCBydW5NYW5hZ2VyKSB7XG4gICAgICAgIGlmICghKHRoaXMuaW5wdXRLZXkgaW4gdmFsdWVzKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBEb2N1bWVudCBrZXkgJHt0aGlzLmlucHV0S2V5fSBub3QgZm91bmQuYCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBbdGhpcy5pbnB1dEtleV06IGRvY3MsIC4uLnJlc3QgfSA9IHZhbHVlcztcbiAgICAgICAgbGV0IGN1cnJlbnREb2NzID0gZG9jcztcbiAgICAgICAgbGV0IGludGVybWVkaWF0ZVN0ZXBzID0gW107XG4gICAgICAgIC8vIEZvciBlYWNoIGl0ZXJhdGlvbiwgd2UnbGwgdXNlIHRoZSBgbGxtQ2hhaW5gIHRvIGdldCBhIG5ldyByZXN1bHRcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm1heEl0ZXJhdGlvbnM7IGkgKz0gMSkge1xuICAgICAgICAgICAgY29uc3QgaW5wdXRzID0gY3VycmVudERvY3MubWFwKChkKSA9PiAoe1xuICAgICAgICAgICAgICAgIFt0aGlzLmRvY3VtZW50VmFyaWFibGVOYW1lXTogZC5wYWdlQ29udGVudCxcbiAgICAgICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgY29uc3QgY2FuU2tpcE1hcFN0ZXAgPSBpICE9PSAwIHx8ICF0aGlzLmVuc3VyZU1hcFN0ZXA7XG4gICAgICAgICAgICBpZiAoY2FuU2tpcE1hcFN0ZXApIHtcbiAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIHRvdGFsIHRva2VucyByZXF1aXJlZCBpbiB0aGUgaW5wdXRcbiAgICAgICAgICAgICAgICBjb25zdCBmb3JtYXR0ZWQgPSBhd2FpdCB0aGlzLmNvbWJpbmVEb2N1bWVudENoYWluLmxsbUNoYWluLnByb21wdC5mb3JtYXQodGhpcy5jb21iaW5lRG9jdW1lbnRDaGFpbi5fcHJlcElucHV0cyh7XG4gICAgICAgICAgICAgICAgICAgIFt0aGlzLmNvbWJpbmVEb2N1bWVudENoYWluLmlucHV0S2V5XTogY3VycmVudERvY3MsXG4gICAgICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGxlbmd0aCA9IGF3YWl0IHRoaXMuY29tYmluZURvY3VtZW50Q2hhaW4ubGxtQ2hhaW4uX2dldE51bVRva2Vucyhmb3JtYXR0ZWQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHdpdGhpblRva2VuTGltaXQgPSBsZW5ndGggPCB0aGlzLm1heFRva2VucztcbiAgICAgICAgICAgICAgICAvLyBJZiB3ZSBjYW4gc2tpcCB0aGUgbWFwIHN0ZXAsIGFuZCB3ZSdyZSB3aXRoaW4gdGhlIHRva2VuIGxpbWl0LCB3ZSBkb24ndFxuICAgICAgICAgICAgICAgIC8vIG5lZWQgdG8gcnVuIHRoZSBtYXAgc3RlcCwgc28ganVzdCBicmVhayBvdXQgb2YgdGhlIGxvb3AuXG4gICAgICAgICAgICAgICAgaWYgKHdpdGhpblRva2VuTGltaXQpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHRoaXMubGxtQ2hhaW4uYXBwbHkoaW5wdXRzLCBcbiAgICAgICAgICAgIC8vIElmIHdlIGhhdmUgYSBydW5NYW5hZ2VyLCB0aGVuIHdlIG5lZWQgdG8gY3JlYXRlIGEgY2hpbGQgZm9yIGVhY2ggaW5wdXRcbiAgICAgICAgICAgIC8vIHNvIHRoYXQgd2UgY2FuIHRyYWNrIHRoZSBwcm9ncmVzcyBvZiBlYWNoIGlucHV0LlxuICAgICAgICAgICAgcnVuTWFuYWdlclxuICAgICAgICAgICAgICAgID8gQXJyYXkuZnJvbSh7IGxlbmd0aDogaW5wdXRzLmxlbmd0aCB9LCAoXywgaSkgPT4gcnVuTWFuYWdlci5nZXRDaGlsZChgbWFwXyR7aSArIDF9YCkpXG4gICAgICAgICAgICAgICAgOiB1bmRlZmluZWQpO1xuICAgICAgICAgICAgY29uc3QgeyBvdXRwdXRLZXkgfSA9IHRoaXMubGxtQ2hhaW47XG4gICAgICAgICAgICAvLyBJZiB0aGUgZmxhZyBpcyBzZXQsIHRoZW4gY29uY2F0IHRoYXQgdG8gdGhlIGludGVybWVkaWF0ZSBzdGVwc1xuICAgICAgICAgICAgaWYgKHRoaXMucmV0dXJuSW50ZXJtZWRpYXRlU3RlcHMpIHtcbiAgICAgICAgICAgICAgICBpbnRlcm1lZGlhdGVTdGVwcyA9IGludGVybWVkaWF0ZVN0ZXBzLmNvbmNhdChyZXN1bHRzLm1hcCgocikgPT4gcltvdXRwdXRLZXldKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjdXJyZW50RG9jcyA9IHJlc3VsdHMubWFwKChyKSA9PiAoe1xuICAgICAgICAgICAgICAgIHBhZ2VDb250ZW50OiByW291dHB1dEtleV0sXG4gICAgICAgICAgICAgICAgbWV0YWRhdGE6IHt9LFxuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICAgIC8vIE5vdywgd2l0aCB0aGUgZmluYWwgcmVzdWx0IG9mIGFsbCB0aGUgaW5wdXRzIGZyb20gdGhlIGBsbG1DaGFpbmAsIHdlIGNhblxuICAgICAgICAvLyBydW4gdGhlIGBjb21iaW5lRG9jdW1lbnRDaGFpbmAgb3ZlciB0aGVtLlxuICAgICAgICBjb25zdCBuZXdJbnB1dHMgPSB7XG4gICAgICAgICAgICBbdGhpcy5jb21iaW5lRG9jdW1lbnRDaGFpbi5pbnB1dEtleV06IGN1cnJlbnREb2NzLFxuICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5jb21iaW5lRG9jdW1lbnRDaGFpbi5jYWxsKG5ld0lucHV0cywgcnVuTWFuYWdlcj8uZ2V0Q2hpbGQoXCJjb21iaW5lX2RvY3VtZW50c1wiKSk7XG4gICAgICAgIC8vIFJldHVybiB0aGUgaW50ZXJtZWRpYXRlIHN0ZXBzIHJlc3VsdHMgaWYgdGhlIGZsYWcgaXMgc2V0XG4gICAgICAgIGlmICh0aGlzLnJldHVybkludGVybWVkaWF0ZVN0ZXBzKSB7XG4gICAgICAgICAgICByZXR1cm4geyAuLi5yZXN1bHQsIGludGVybWVkaWF0ZVN0ZXBzIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgX2NoYWluVHlwZSgpIHtcbiAgICAgICAgcmV0dXJuIFwibWFwX3JlZHVjZV9kb2N1bWVudHNfY2hhaW5cIjtcbiAgICB9XG4gICAgc3RhdGljIGFzeW5jIGRlc2VyaWFsaXplKGRhdGEpIHtcbiAgICAgICAgaWYgKCFkYXRhLmxsbV9jaGFpbikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWlzc2luZyBsbG1fY2hhaW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFkYXRhLmNvbWJpbmVfZG9jdW1lbnRfY2hhaW4pIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1pc3NpbmcgY29tYmluZV9kb2N1bWVudF9jaGFpblwiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IE1hcFJlZHVjZURvY3VtZW50c0NoYWluKHtcbiAgICAgICAgICAgIGxsbUNoYWluOiBhd2FpdCBMTE1DaGFpbi5kZXNlcmlhbGl6ZShkYXRhLmxsbV9jaGFpbiksXG4gICAgICAgICAgICBjb21iaW5lRG9jdW1lbnRDaGFpbjogYXdhaXQgU3R1ZmZEb2N1bWVudHNDaGFpbi5kZXNlcmlhbGl6ZShkYXRhLmNvbWJpbmVfZG9jdW1lbnRfY2hhaW4pLFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgc2VyaWFsaXplKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgX3R5cGU6IHRoaXMuX2NoYWluVHlwZSgpLFxuICAgICAgICAgICAgbGxtX2NoYWluOiB0aGlzLmxsbUNoYWluLnNlcmlhbGl6ZSgpLFxuICAgICAgICAgICAgY29tYmluZV9kb2N1bWVudF9jaGFpbjogdGhpcy5jb21iaW5lRG9jdW1lbnRDaGFpbi5zZXJpYWxpemUoKSxcbiAgICAgICAgfTtcbiAgICB9XG59XG4vKipcbiAqIENvbWJpbmUgZG9jdW1lbnRzIGJ5IGRvaW5nIGEgZmlyc3QgcGFzcyBhbmQgdGhlbiByZWZpbmluZyBvbiBtb3JlIGRvY3VtZW50cy5cbiAqIEBhdWdtZW50cyBCYXNlQ2hhaW5cbiAqIEBhdWdtZW50cyBSZWZpbmVEb2N1bWVudHNDaGFpbklucHV0XG4gKi9cbmV4cG9ydCBjbGFzcyBSZWZpbmVEb2N1bWVudHNDaGFpbiBleHRlbmRzIEJhc2VDaGFpbiB7XG4gICAgc3RhdGljIGxjX25hbWUoKSB7XG4gICAgICAgIHJldHVybiBcIlJlZmluZURvY3VtZW50c0NoYWluXCI7XG4gICAgfVxuICAgIGdldCBkZWZhdWx0RG9jdW1lbnRQcm9tcHQoKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbXB0VGVtcGxhdGUoe1xuICAgICAgICAgICAgaW5wdXRWYXJpYWJsZXM6IFtcInBhZ2VfY29udGVudFwiXSxcbiAgICAgICAgICAgIHRlbXBsYXRlOiBcIntwYWdlX2NvbnRlbnR9XCIsXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBnZXQgaW5wdXRLZXlzKCkge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgLi4ubmV3IFNldChbXG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dEtleSxcbiAgICAgICAgICAgICAgICAuLi50aGlzLmxsbUNoYWluLmlucHV0S2V5cyxcbiAgICAgICAgICAgICAgICAuLi50aGlzLnJlZmluZUxMTUNoYWluLmlucHV0S2V5cyxcbiAgICAgICAgICAgIF0pLFxuICAgICAgICBdLmZpbHRlcigoa2V5KSA9PiBrZXkgIT09IHRoaXMuZG9jdW1lbnRWYXJpYWJsZU5hbWUgJiYga2V5ICE9PSB0aGlzLmluaXRpYWxSZXNwb25zZU5hbWUpO1xuICAgIH1cbiAgICBnZXQgb3V0cHV0S2V5cygpIHtcbiAgICAgICAgcmV0dXJuIFt0aGlzLm91dHB1dEtleV07XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yKGZpZWxkcykge1xuICAgICAgICBzdXBlcihmaWVsZHMpO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJsbG1DaGFpblwiLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogdm9pZCAwXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJpbnB1dEtleVwiLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogXCJpbnB1dF9kb2N1bWVudHNcIlxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwib3V0cHV0S2V5XCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiBcIm91dHB1dF90ZXh0XCJcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImRvY3VtZW50VmFyaWFibGVOYW1lXCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiBcImNvbnRleHRcIlxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiaW5pdGlhbFJlc3BvbnNlTmFtZVwiLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogXCJleGlzdGluZ19hbnN3ZXJcIlxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwicmVmaW5lTExNQ2hhaW5cIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IHZvaWQgMFxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiZG9jdW1lbnRQcm9tcHRcIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IHRoaXMuZGVmYXVsdERvY3VtZW50UHJvbXB0XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmxsbUNoYWluID0gZmllbGRzLmxsbUNoYWluO1xuICAgICAgICB0aGlzLnJlZmluZUxMTUNoYWluID0gZmllbGRzLnJlZmluZUxMTUNoYWluO1xuICAgICAgICB0aGlzLmRvY3VtZW50VmFyaWFibGVOYW1lID1cbiAgICAgICAgICAgIGZpZWxkcy5kb2N1bWVudFZhcmlhYmxlTmFtZSA/PyB0aGlzLmRvY3VtZW50VmFyaWFibGVOYW1lO1xuICAgICAgICB0aGlzLmlucHV0S2V5ID0gZmllbGRzLmlucHV0S2V5ID8/IHRoaXMuaW5wdXRLZXk7XG4gICAgICAgIHRoaXMub3V0cHV0S2V5ID0gZmllbGRzLm91dHB1dEtleSA/PyB0aGlzLm91dHB1dEtleTtcbiAgICAgICAgdGhpcy5kb2N1bWVudFByb21wdCA9IGZpZWxkcy5kb2N1bWVudFByb21wdCA/PyB0aGlzLmRvY3VtZW50UHJvbXB0O1xuICAgICAgICB0aGlzLmluaXRpYWxSZXNwb25zZU5hbWUgPVxuICAgICAgICAgICAgZmllbGRzLmluaXRpYWxSZXNwb25zZU5hbWUgPz8gdGhpcy5pbml0aWFsUmVzcG9uc2VOYW1lO1xuICAgIH1cbiAgICAvKiogQGlnbm9yZSAqL1xuICAgIGFzeW5jIF9jb25zdHJ1Y3RJbml0aWFsSW5wdXRzKGRvYywgcmVzdCkge1xuICAgICAgICBjb25zdCBiYXNlSW5mbyA9IHtcbiAgICAgICAgICAgIHBhZ2VfY29udGVudDogZG9jLnBhZ2VDb250ZW50LFxuICAgICAgICAgICAgLi4uZG9jLm1ldGFkYXRhLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBkb2N1bWVudEluZm8gPSB7fTtcbiAgICAgICAgdGhpcy5kb2N1bWVudFByb21wdC5pbnB1dFZhcmlhYmxlcy5mb3JFYWNoKCh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgZG9jdW1lbnRJbmZvW3ZhbHVlXSA9IGJhc2VJbmZvW3ZhbHVlXTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGJhc2VJbnB1dHMgPSB7XG4gICAgICAgICAgICBbdGhpcy5kb2N1bWVudFZhcmlhYmxlTmFtZV06IGF3YWl0IHRoaXMuZG9jdW1lbnRQcm9tcHQuZm9ybWF0KHtcbiAgICAgICAgICAgICAgICAuLi5kb2N1bWVudEluZm8sXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgaW5wdXRzID0geyAuLi5iYXNlSW5wdXRzLCAuLi5yZXN0IH07XG4gICAgICAgIHJldHVybiBpbnB1dHM7XG4gICAgfVxuICAgIC8qKiBAaWdub3JlICovXG4gICAgYXN5bmMgX2NvbnN0cnVjdFJlZmluZUlucHV0cyhkb2MsIHJlcykge1xuICAgICAgICBjb25zdCBiYXNlSW5mbyA9IHtcbiAgICAgICAgICAgIHBhZ2VfY29udGVudDogZG9jLnBhZ2VDb250ZW50LFxuICAgICAgICAgICAgLi4uZG9jLm1ldGFkYXRhLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBkb2N1bWVudEluZm8gPSB7fTtcbiAgICAgICAgdGhpcy5kb2N1bWVudFByb21wdC5pbnB1dFZhcmlhYmxlcy5mb3JFYWNoKCh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgZG9jdW1lbnRJbmZvW3ZhbHVlXSA9IGJhc2VJbmZvW3ZhbHVlXTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGJhc2VJbnB1dHMgPSB7XG4gICAgICAgICAgICBbdGhpcy5kb2N1bWVudFZhcmlhYmxlTmFtZV06IGF3YWl0IHRoaXMuZG9jdW1lbnRQcm9tcHQuZm9ybWF0KHtcbiAgICAgICAgICAgICAgICAuLi5kb2N1bWVudEluZm8sXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgaW5wdXRzID0geyBbdGhpcy5pbml0aWFsUmVzcG9uc2VOYW1lXTogcmVzLCAuLi5iYXNlSW5wdXRzIH07XG4gICAgICAgIHJldHVybiBpbnB1dHM7XG4gICAgfVxuICAgIC8qKiBAaWdub3JlICovXG4gICAgYXN5bmMgX2NhbGwodmFsdWVzLCBydW5NYW5hZ2VyKSB7XG4gICAgICAgIGlmICghKHRoaXMuaW5wdXRLZXkgaW4gdmFsdWVzKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBEb2N1bWVudCBrZXkgJHt0aGlzLmlucHV0S2V5fSBub3QgZm91bmQuYCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBbdGhpcy5pbnB1dEtleV06IGRvY3MsIC4uLnJlc3QgfSA9IHZhbHVlcztcbiAgICAgICAgY29uc3QgY3VycmVudERvY3MgPSBkb2NzO1xuICAgICAgICBjb25zdCBpbml0aWFsSW5wdXRzID0gYXdhaXQgdGhpcy5fY29uc3RydWN0SW5pdGlhbElucHV0cyhjdXJyZW50RG9jc1swXSwgcmVzdCk7XG4gICAgICAgIGxldCByZXMgPSBhd2FpdCB0aGlzLmxsbUNoYWluLnByZWRpY3QoeyAuLi5pbml0aWFsSW5wdXRzIH0sIHJ1bk1hbmFnZXI/LmdldENoaWxkKFwiYW5zd2VyXCIpKTtcbiAgICAgICAgY29uc3QgcmVmaW5lU3RlcHMgPSBbcmVzXTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBjdXJyZW50RG9jcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgY29uc3QgcmVmaW5lSW5wdXRzID0gYXdhaXQgdGhpcy5fY29uc3RydWN0UmVmaW5lSW5wdXRzKGN1cnJlbnREb2NzW2ldLCByZXMpO1xuICAgICAgICAgICAgY29uc3QgaW5wdXRzID0geyAuLi5yZWZpbmVJbnB1dHMsIC4uLnJlc3QgfTtcbiAgICAgICAgICAgIHJlcyA9IGF3YWl0IHRoaXMucmVmaW5lTExNQ2hhaW4ucHJlZGljdCh7IC4uLmlucHV0cyB9LCBydW5NYW5hZ2VyPy5nZXRDaGlsZChcInJlZmluZVwiKSk7XG4gICAgICAgICAgICByZWZpbmVTdGVwcy5wdXNoKHJlcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgW3RoaXMub3V0cHV0S2V5XTogcmVzIH07XG4gICAgfVxuICAgIF9jaGFpblR5cGUoKSB7XG4gICAgICAgIHJldHVybiBcInJlZmluZV9kb2N1bWVudHNfY2hhaW5cIjtcbiAgICB9XG4gICAgc3RhdGljIGFzeW5jIGRlc2VyaWFsaXplKGRhdGEpIHtcbiAgICAgICAgY29uc3QgU2VyaWFsaXplZExMTUNoYWluID0gZGF0YS5sbG1fY2hhaW47XG4gICAgICAgIGlmICghU2VyaWFsaXplZExMTUNoYWluKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaXNzaW5nIGxsbV9jaGFpblwiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBTZXJpYWxpemVkUmVmaW5lRG9jdW1lbnRDaGFpbiA9IGRhdGEucmVmaW5lX2xsbV9jaGFpbjtcbiAgICAgICAgaWYgKCFTZXJpYWxpemVkUmVmaW5lRG9jdW1lbnRDaGFpbikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWlzc2luZyByZWZpbmVfbGxtX2NoYWluXCIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUmVmaW5lRG9jdW1lbnRzQ2hhaW4oe1xuICAgICAgICAgICAgbGxtQ2hhaW46IGF3YWl0IExMTUNoYWluLmRlc2VyaWFsaXplKFNlcmlhbGl6ZWRMTE1DaGFpbiksXG4gICAgICAgICAgICByZWZpbmVMTE1DaGFpbjogYXdhaXQgTExNQ2hhaW4uZGVzZXJpYWxpemUoU2VyaWFsaXplZFJlZmluZURvY3VtZW50Q2hhaW4pLFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgc2VyaWFsaXplKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgX3R5cGU6IHRoaXMuX2NoYWluVHlwZSgpLFxuICAgICAgICAgICAgbGxtX2NoYWluOiB0aGlzLmxsbUNoYWluLnNlcmlhbGl6ZSgpLFxuICAgICAgICAgICAgcmVmaW5lX2xsbV9jaGFpbjogdGhpcy5yZWZpbmVMTE1DaGFpbi5zZXJpYWxpemUoKSxcbiAgICAgICAgfTtcbiAgICB9XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(app-pages-browser)/./node_modules/langchain/dist/chains/combine_docs_chain.js\n"));

/***/ })

}]);